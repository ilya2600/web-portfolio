<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Pet World</title>
    <style>
        /*
        –æ—Ç—Å—Ç—É–ø—ã:
            - padding
            - margin
        —Ü–≤–µ—Ç–∞:
            - color
            - background-color
            - background: linear-gradient()
        —à—Ä–∏—Ñ—Ç—ã:
            - font-size, weight, style, family
        –≥—Ä–∞–Ω–∏—Ü–∞:
            - border-color
            - border-width
            - border-style
            - border-radius
        —Ç–µ–Ω—å:
            - box-shadow
            - text-shadow
        —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:
            - display: flex
            - flex-direction
            - justify-content
            - align-items / align-content
        */
        .pet {
            display: inline-block;
            text-align: center;
            position: absolute;
            left: 90%;
            top: 90%;
            user-select: none;
        }

        #pet-icon {
            cursor: pointer;
        }

        #play-area {
            background-color: #91e091;
            width: 500px;
            height: 500px;
            position: relative;
        }
    </style>
</head>

<body>
    <div id="ui">
        <input id="name" type="text" placeholder="–ò–º—è..." value="–ü–∏—Ç–æ–º–µ—Ü">
        <input id="icon" type="text" placeholder="–ò–∫–æ–Ω–∫–∞..." value="üí•">
        <input id="color" type="color" placeholder="–¶–≤–µ—Ç –∏–º–µ–Ω–∏...">
        <input id="size" type="number" placeholder="–†–∞–∑–º–µ—Ä..." value=25>
        <input id="speed" type="number" placeholder="–°–∫–æ—Ä–æ—Å—Ç—å..." value=2>
        <button onclick="AddPet()">–°–æ–∑–¥–∞—Ç—å</button>
        <button onclick="ClearPets()">–û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>

    <div id="play-area">

    </div>


    <script>
        let petObjects = localStorage.getItem("pw-pets")
        petObjects = petObjects === null ? [] : JSON.parse(petObjects)
        
        function ClearPets(){
            petObjects = []
            localStorage.setItem("pw-pets", null)
        }


        function AddPet() {
            let nameInp = document.querySelector("#name")
            let iconInp = document.querySelector("#icon")
            let colorInp = document.querySelector("#color")
            let sizeInp = document.querySelector("#size")
            let speedInp = document.querySelector("#speed")

            let petObj = {}

            petObj.name = nameInp.value
            petObj.icon = iconInp.value
            petObj.color = colorInp.value
            petObj.size = sizeInp.value
            petObj.speed = speedInp.value
            petObj.hunger = 10

            petObjects.push(petObj)

            console.log(petObjects)

            /*pet.querySelector("#pet-name").textContent = petObj.name
            pet.querySelector("#pet-icon").textContent = petObj.icon
            
            pet.style.color = petObj.color
            pet.querySelector("#pet-icon").style.fontSize = petObj.size + "px"*/

            let posX = "50%"
            let posY = "50%"

            let playArea = document.querySelector("#play-area")
            playArea.innerHTML += `<div class='pet' style="left:${posX}; right:${posY};">
                                        <div id="pet-name" style="color:${petObj.color}">${petObj.name}</div>
                                        <div id="pet-icon" style="font-size:${petObj.size}px" onclick="PetFeed(event)">${petObj.icon}</div>
                                    </div>`

        }

        function LoadPets() {
            let i = 0
            while (i < petObjects.length) {
                let petObj = petObjects[i]

                let posX = "50%"
                let posY = "50%"

                let playArea = document.querySelector("#play-area")
                playArea.innerHTML += `<div class='pet' style="left:${posX}; right:${posY};">
                                        <div id="pet-name" style="color:${petObj.color}">${petObj.name}</div>
                                        <div id="pet-icon" style="font-size:${petObj.size}px" onclick="PetFeed(event)">${petObj.icon}</div>
                                    </div>`

                i++
            }


        }
        
        LoadPets()

        function PetFeed(petEvent) {
            console.log("feed!!!", petEvent.target)

            let targetPet = petEvent.target.parentElement

            let petElements = document.querySelectorAll(".pet")

            let i = 0
            while (i < petElements.length) {
                if (targetPet === petElements[i]) {
                    break
                }


                console.log(
                    targetPet === petElements[i],
                    targetPet,
                    petElements[i]
                )


                i++
            }

            console.log("pet index: ", i)

            petObjects[i].hunger += 1
        }

        setInterval(MainLoop, 150)

        function MainLoop() {
            SavePets()
            PetHunger()
            PetMove()
        }

        function SavePets() {
            localStorage.setItem("pw-pets", JSON.stringify(petObjects))
        }

        function PetHunger() {
            let j = 0
            while (j < petObjects.length) {
                let hVal = 0.02
                petObjects[j].hunger -= hVal - (hVal / petObjects[j].size)
                //console.log(petObjects[j].name, petObjects[j].hunger)

                let petElements = document.querySelectorAll(".pet")
                let pet = petElements[j]

                if (petObjects[j].hunger <= 0) {
                    pet.querySelector("#pet-icon").textContent = "‚ò†"
                }


                j++
            }
        }

        //pet.style.left = "25%"
        //pet.style.top = "25%"

        function PetMove() {
            //console.log(pet.style.left) 
            //console.log(Number("124px"[0]))

            let petElements = document.querySelectorAll(".pet")

            let j = 0
            while (j < petElements.length) {
                let petObj = petObjects[j]
                if (petObjects[j].hunger <= 0) {
                    j++
                    continue
                }
                let pet = petElements[j]

                pet.querySelector("#pet-name").textContent = petObj.name + `(${Math.ceil(petObj.hunger)})`

                let strPosX = pet.style.left
                //console.log("pet.style.left: ", pet.style.left)
                let strPosY = pet.style.top
                //console.log("pet.style.top: ", pet.style.top)

                let posX = ""
                let posY = ""

                let i = 0
                while (i < strPosX.length) {
                    if (strPosX[i] === "%") break
                    posX += strPosX[i]
                    i++
                }
                posX = Number(posX)

                i = 0
                while (i < strPosY.length) {
                    if (strPosY[i] === "%") break
                    posY += strPosY[i]
                    i++
                }
                posY = Number(posY)

                let speed = petObjects[j].speed
                let randX = (Math.random() * speed) - (speed / 2)
                let randY = (Math.random() * speed) - (speed / 2)

                posX += randX
                posY += randY

                if (posX > 100) posX = 100
                if (posX < 0) posX = 0

                if (posY > 100) posY = 100
                if (posY < 0) posY = 0

                pet.style.left = posX + "%"
                pet.style.top = posY + "%"
                j++
            }



        }
    </script>
</body></html>
